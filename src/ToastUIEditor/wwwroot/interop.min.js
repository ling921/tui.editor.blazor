import"./toastui-editor-all.min.js";function getPrefersColorScheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function getKeyboardEventArgs(e){return{key:e.key,code:e.code,location:e.location,repeat:e.repeat,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,type:e.type}}function decycle(e,t=new Set,o=[],r=new WeakMap){if(!e||"object"!=typeof e)return e;if(t.has(e)){const t=`${o.indexOf(e)+1}`;return r.set(e,t),{$ref:t}}let n;o.length;if(o.push(e),Array.isArray(e)){n=[],t.add(e);for(let s=0;s<e.length;s++)n[s]=decycle(e[s],t,o,r);t.delete(e)}else{n={},t.add(e);for(let s in e)e.hasOwnProperty(s)&&(n[s]=decycle(e[s],t,o,r));t.delete(e)}return r.has(e)&&(n.$id=r.get(e)),n}export class ToastUI{instance=null;type="editor";dotNetRefs=[];constructor(e){if(!e.el)throw new Error("element is required in options");e.viewer?(e.events=this._viewerEvents(e.ref),this.type="viewer"):(e.events=this._editorEvents(e.ref),this.widgetRules=this._resolveEditorWidgetRules(e.widgetRules),this.type="editor"),e.theme="auto"===e.theme?getPrefersColorScheme():e.theme||"light",this.instance=toastui.Editor.factory(e)}static factory(e){return new ToastUI(e)}static setLanguage(e,t){toastui.Editor.setLanguage(e,t)}static setLanguages(e){Object.keys(e).forEach((t=>{ToastUI.setLanguage(t,e[t])}))}static setDefaultLanguage(e){toastui.Editor.i18n.setCode(e)}_commonEvents(e){if(!e)throw new Error("ref in options is required.");return{load:t=>{e.invokeMethodAsync("load")}}}_editorEvents(e){return{...this._commonEvents(e),change:t=>{const o="wysiwyg"===t?this.instance.getHTML():this.instance.getMarkdown();e.invokeMethodAsync("change",t,o)},caretChange:t=>{e.invokeMethodAsync("caretChange",t)},focus:t=>{e.invokeMethodAsync("focus",t)},blur:t=>{e.invokeMethodAsync("blur",t)},keydown:(t,o)=>{e.invokeMethodAsync("keydown",t,getKeyboardEventArgs(o))},keyup:(t,o)=>{e.invokeMethodAsync("keyup",t,getKeyboardEventArgs(o))},beforePreviewRender:t=>(e.invokeMethodAsync("beforePreviewRender",t),t),beforeConvertWysiwygToMarkdown:t=>(e.invokeMethodAsync("beforeConvertWysiwygToMarkdown",t),t)}}_viewerEvents(e){return{...this._commonEvents(e),change:(...t)=>{e.invokeMethodAsync("change",t)},updatePreview:t=>{e.invokeMethodAsync("updatePreview",decycle(t))}}}_resolveEditorWidgetRules(e){return e&&Array.isArray(e)?e.map((e=>(this.dotNetRefs.push(e.ref),{rule:new RegExp(e.rule,"g"),toDOM:t=>e.ref.invokeMethodAsync("toDOM",t)}))):null}destroy(){this.instance?.destroy(),this.dotNetRefs.forEach((e=>{e.dispose()}))}}